import{getParentElement}from"./rendering.js";import{isEscape}from"./utils.js";const body=document.querySelector(".page-body"),portfolioBlock=document.querySelector(".micflag__portfolio");function getCurrentPortItem(){let t=null,e=null,n=null;return{setCurrent:function(e){t=e},getCurrent:function(){return t},setTarget:function(t){e=t},getTarget:function(){return e},setPopUp:function(t){n=t},getPopUp:function(){return n},reset:function(){n=null,e=null,t=null}}}const portCurrnet=getCurrentPortItem();function createPopUp(){const t=portfolioBlock.querySelector("#portfolo-popUp").content.cloneNode(!0);body.appendChild(t)}function closePopUp(){window.removeEventListener("keydown",escapeClose),window.removeEventListener("keydown",onKeyNav),portCurrnet.getPopUp().removeEventListener("click",onNavBtn),portCurrnet.getPopUp().remove(),portCurrnet.getPopUp().removeEventListener("click",onClickingOnVoid),portCurrnet.getPopUp().removeEventListener("click",onClikcCloseBtn),portCurrnet.reset(),portfolioBlock.addEventListener("click",onClickPortfolio)}function escapeClose(t){isEscape(t)&&closePopUp()}function isPopUp(t){return t.target.classList.contains("pop-up")}function isCloseBtn(t){return t.target.classList.contains("pop-up__close-btn")}function onClickingOnVoid(t){isPopUp(t)&&closePopUp()}function onClikcCloseBtn(t){isCloseBtn(t)&&closePopUp()}function fillImageData(t,e){const n=Array.from(t.children),o=Array.from(e.children);n.forEach((function(t,e){"IMG"===t.tagName?(o[e].src=pathDetected(t.src),o[e].srcset=pathDetected(t.srcset),o[e].alt=t.alt,o[e].dataset.type=t.dataset.type,o[e].width="1042",o[e].height="744"):o[e].srcset=pathDetected(t.srcset)}))}function onNavBtn(t){let e=portCurrnet.getCurrent(),n=portCurrnet.getTarget();t.target.classList.contains("pop-up__image-navigation")&&(t.target.classList.contains("pop-up__image-navigation--next")?(e=e.nextElementSibling?e.nextElementSibling:e.parentElement.firstElementChild,portCurrnet.setCurrent(e)):(e=e.previousElementSibling?e.previousElementSibling:e.parentElement.lastElementChild,portCurrnet.setCurrent(e)),fillImageData(e.querySelector(".portfolio__item-pic-contaner"),n))}function setNavBtns(){portCurrnet.getPopUp()&&portCurrnet.getPopUp().addEventListener("click",onNavBtn)}function setPortKeyDown(){portCurrnet.getPopUp()&&window.addEventListener("keydown",onKeyNav)}function onKeyNav(t){let e=portCurrnet.getCurrent(),n=portCurrnet.getTarget();"ArrowDown"!==t.code&&"ArrowUp"!==t.code||t.preventDefault(),"ArrowRight"===t.code?(t.preventDefault(),e=e.nextElementSibling?e.nextElementSibling:e.parentElement.firstElementChild,portCurrnet.setCurrent(e)):"ArrowLeft"===t.code&&(t.preventDefault(),e=e.previousElementSibling?e.previousElementSibling:e.parentElement.lastElementChild,portCurrnet.setCurrent(e)),fillImageData(e.querySelector(".portfolio__item-pic-contaner"),n)}function onClickPortfolio(t){const e=getParentElement(t.target,"portfolio__item");if(e){createPopUp(),portCurrnet.setPopUp(document.querySelector(".pop-up")),portCurrnet.setCurrent(e);let t=e.querySelector(".portfolio__item-pic-contaner"),n=portCurrnet.getPopUp().querySelector(".pop-up__image-block");portCurrnet.setTarget(n),t&&n&&(fillImageData(t,n),window.addEventListener("keydown",escapeClose),portCurrnet.getPopUp().addEventListener("click",onClickingOnVoid),portCurrnet.getPopUp().addEventListener("click",onClikcCloseBtn),setNavBtns(),setPortKeyDown())}portfolioBlock.removeEventListener("click",onClickPortfolio)}function startPrtfolio(){portfolioBlock&&portfolioBlock.addEventListener("click",onClickPortfolio)}function pathDetected(t){return t.split(",").length>1?t.split(",").reduce((function(t,e){return t+`, ${getFullPath(e)}`}),""):getFullPath(t)}function getStringStart(t){return t.split("").slice(0,t.lastIndexOf("/")+1).join("")}function getFullPath(t){return getStringStart(t)+getFileName(t)+"-full"+getStringEnd(t)}function switchChar(t){return-1===t.lastIndexOf("@")?".":"@"}function getStringEnd(t){let e=switchChar(t);return t.split("").slice(t.lastIndexOf(e),t.length).join("")}function getFileName(t){let e=switchChar(t);return t.split("").slice(t.lastIndexOf("/")+1,t.lastIndexOf(e)).join("")}startPrtfolio();export{portfolioBlock};